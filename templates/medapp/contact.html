{% extends 'medapp/base.html' %}

{% block title %}Contact - MedApp{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="text-center mb-5">
        <h1 class="display-4 fw-bold text-primary">Contact Us</h1>
        <div class="d-flex justify-content-center align-items-center my-3">
            <div class="bg-primary" style="height: 2px; width: 35px;"></div>
            <div class="mx-3 text-primary"><i class="fas fa-envelope"></i></div>
            <div class="bg-primary" style="height: 2px; width: 35px;"></div>
        </div>
        <p class="lead">We'd love to hear from you! Reach out using any of the methods below.</p>

        <!-- Social Media Icons - More Prominently Displayed -->
        <div class="d-flex justify-content-center flex-wrap mt-4 mb-5">
            <a href="#"
                class="d-inline-flex align-items-center justify-content-center text-white rounded-circle mx-2 mb-2"
                style="width: 48px; height: 48px; transition: all 0.3s ease; background-color: #E1306C;">
                <i class="fab fa-instagram"></i>
            </a>
            <a href="#"
                class="d-inline-flex align-items-center justify-content-center text-white rounded-circle mx-2 mb-2"
                style="width: 48px; height: 48px; transition: all 0.3s ease; background-color: #25D366;">
                <i class="fab fa-whatsapp"></i>
            </a>
        </div>
    </div>

    <div class="row g-4">
        <div class="col-md-6">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-body p-4">
                    <div class="d-flex align-items-center mb-3">
                        <i class="fas fa-map-marker-alt fs-3 text-primary me-3"></i>
                        <h3 class="card-title mb-0">Our Office</h3>
                    </div>
                    <hr>
                    <div class="ps-2">
                        <p class="mb-3">
                            <strong><i class="fas fa-map-marker-alt me-2"></i>Address:</strong><br>
                            <a href="https://maps.google.com/?q=123+Medical+Street+Health+City+HC+12345" target="_blank"
                                class="text-decoration-none">
                                123 Medical Street<br>
                                Health City, HC 12345
                            </a>
                        </p>
                        <p class="mb-3">
                            <strong><i class="fas fa-phone-alt me-2"></i>Phone:</strong><br>
                            <a href="tel:+1234567890" class="text-decoration-none"><i
                                    class="fab fa-whatsapp text-success me-1"></i>(123) 456-7890</a><br>
                            <a href="tel:+1987654321" class="text-decoration-none"><i
                                    class="fas fa-phone-alt text-success me-1"></i>(987) 654-3210</a>
                        </p>
                        <p>
                            <strong><i class="fas fa-envelope me-2"></i>Email:</strong><br>
                            <a href="mailto:info@medapp.com" class="text-decoration-none"><i
                                    class="far fa-envelope me-1"></i>info@medapp.com</a><br>
                            <a href="mailto:support@medapp.com" class="text-decoration-none"><i
                                    class="far fa-envelope me-1"></i>support@medapp.com</a>
                        </p>
                    </div>
                    <div class="mt-3">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body p-0">
                                <div class="rounded overflow-hidden">
                                    <iframe
                                        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3151.835253681801!2d144.96305025!3d-37.8172139!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x6ad642af0f11fd81%3A0x5045675218ce7e0!2sMelbourne%20VIC%2C%20Australia!5e0!3m2!1sen!2sus!4v1659012345678!5m2!1sen!2sus"
                                        width="100%" height="250" style="border:0;" allowfullscreen="" loading="lazy"
                                        referrerpolicy="no-referrer-when-downgrade">
                                    </iframe>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-body p-4">
                    <div class="d-flex align-items-center mb-3">
                        <i class="fas fa-paper-plane fs-3 text-primary me-3"></i>
                        <h3 class="card-title mb-0">Send Us a Message</h3>
                    </div>
                    <hr>
                    <form method="post">
                        {% csrf_token %}
                        <div class="mb-3">
                            <label for="name" class="form-label">Your Name</label>
                            <input type="text" class="form-control" id="name" name="name" placeholder="Enter your name"
                                required>
                        </div>
                        <div class="mb-3">
                            <label for="email" class="form-label">Your Email</label>
                            <input type="email" class="form-control" id="email" name="email"
                                placeholder="Enter your email" required>
                        </div>
                        <div class="mb-3">
                            <label for="phone_number" class="form-label">Your Phone Number</label>
                            <input type="text" class="form-control" id="phone_number" name="phone_number"
                                placeholder="Enter your phone number" required>
                        </div>
                        <div class="mb-3">
                            <label for="message" class="form-label">Your Message</label>
                            <textarea class="form-control" id="message" name="message" rows="5"
                                placeholder="Type your message here" required></textarea>
                        </div>
                        <div class="mb-3">
                            <div class="d-flex align-items-center">
                                <label for="whatsapp" class="me-3">Contact via WhatsApp</label>
                                <div class="form-check form-switch">
                                    <input type="checkbox" class="form-check-input" name="whatsapp" id="whatsapp"
                                        role="switch">
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Send Message</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Success Modal -->
<div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="successModalLabel">Success</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Your message has been sent successfully!
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById('whatsapp').addEventListener('change', function () {
        const phoneNumber = document.querySelector('input[name="phone_number"]').value;
        if (this.checked) {
            alert(`You will be contacted via WhatsApp at ${phoneNumber}.`);
        } else {
            alert('You will not be contacted via WhatsApp at ' + phoneNumber + '.');
        }
    });

    document.querySelector('form').addEventListener('submit', async function (event) {
        event.preventDefault();
        
        const email = document.querySelector('input[name="email"]').value;
        const phoneNumber = document.querySelector('input[name="phone_number"]').value;
        const whatsappChecked = document.getElementById('whatsapp').checked;

        // Check if email or phone number already exists
        try {
            const response = await fetch('/check-contact-exists/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                },
                body: JSON.stringify({
                    email: email,
                    phone_number: phoneNumber
                })
            });

            const data = await response.json();
            
            if (data.exists) {
                alert('A contact with this email or phone number already exists!');
                return;
            }

            // Show success modal
            const modalBody = document.querySelector('#successModal .modal-body');
            modalBody.textContent = `You will be contacted via ${whatsappChecked ? 'WhatsApp at ' + phoneNumber : 'your provided email.'}`;
            var myModal = new bootstrap.Modal(document.getElementById('successModal'));
            myModal.show();

            // Submit the form
            this.submit();
        } catch (error) {
            console.error('Error:', error);
            alert('An error occurred while checking contact details.');
        }
    });
</script>
{% endblock %}